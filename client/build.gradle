apply plugin: "io.github.goooler.shadow"

dependencies {
    shadow implementation(project(path: ':common', configuration: 'default'))
    shadow "com.esotericsoftware:kryo5:${project.kyro_version}"
    shadow "io.netty:netty-buffer:${project.netty_version}"
    shadow "io.netty:netty-transport:${project.netty_version}"
    shadow "io.netty:netty-handler:${project.netty_version}"
}

shadowJar {
    archiveBaseName.set("protoweaver")
    archiveClassifier.set(project.name)
    configurations = [project.configurations.shadow]

    dependencies {
        mergeServiceFiles()
    }

    relocate "com.esotericsoftware", "me.mrnavastar.protoweaver.libs.esotericsoftware"
    relocate 'io.netty', 'me.mrnavastar.protoweaver.libs.netty'

    exclude "META-INF/maven/**"
    exclude "META-INF/native-image/**"
    exclude "org/bouncycastle/**"
    minimize()
}

jar.finalizedBy(shadowJar)